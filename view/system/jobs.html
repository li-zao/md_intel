{extend  name="layout" /}
{block name="breadcrumb"}
<a><cite>{$breadcrumb}</cite></a>
{/block}
{block name="content"}
<style>
    .search-item {
        margin-bottom: 0;
    }
</style>
<div class="layui-row layui-margin-2">
    <div class="layui-col-md12">
        <div class="layui-collapse">
            <div class="layui-colla-item">
                <h2 class="layui-colla-title"><i class="fa-light fa-magnifying-glass"></i> 检索</h2>
                <div class="layui-colla-content" style="padding:0">
                    <form class="layui-form layui-form-pane" action="" id="searchForm">
                        <table class="layui-table search-table">
                            <!-- <colgroup> -->
                            <!--     <col style="width:25%"> -->
                            <!--     <col style="width:25%"> -->
                            <!--     <col style="width:25%"> -->
                            <!--     <col style="width:25%"> -->
                            <!-- </colgroup> -->
                            <tbody>
                            <tr>
                                <td>
                                    <div class="layui-form-item search-item">
                                        <label class="layui-form-label">队列任务</label>
                                        <div class="layui-input-block">
                                            <select name="queue" lay-filter="queue">
                                                <option value=""></option>
                                                {foreach $dict as $key => $val}
                                                <option value="{$key}">{$key} => {$val}</option>
                                                {/foreach}
                                            </select>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="">
                                    <div class="layui-form-item search-item">
                                        <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" id="resetBtn"
                                                style="float:right"><i class="fa-light fa-magnifying-glass-arrows-rotate"></i> 重置
                                        </button>
                                        <button type="button" class="layui-btn layui-btn-normal layui-btn-sm" id="searchBtn"
                                                style="float:right;margin-right:10px"> <i class="fa-light fa-magnifying-glass"></i> 查询
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="layui-row layui-padding-3">
    <div class="layui-col-md12">
        <div id="jobs-div" lay-filter="data_table"></div>
    </div>
</div>
<script>
    var table = layui.table;
    var layer = layui.layer;
    let tableFlag = 'jobs';
    let colsHideDict = loadTableCols(tableFlag);
    let colsWidthDict = loadTableCols(tableFlag, 'width');
    var instance = table.render({
        elem: '#jobs-div',
        url: '/system/jobList',
        page: true,
        cols: [[
            {field: 'id', title: 'ID', width: 80, sort: true},
            {
                field: 'queue',
                title: '队列',
                width: colsWidthDict.get('queue') || 120,
                hide: colsHideDict.get('queue')
            },
            {
                field: 'payload',
                title: 'Payload',
                width: colsWidthDict.get('payload') || 500,
                hide: colsHideDict.get('payload')
            },
            {
                field: 'attempts',
                title: 'Attempts',
                width: colsWidthDict.get('attempts') || 120,
                hide: colsHideDict.get('attempts')
            },
            {
                field: 'create_time',
                title: '创建时间',
                width: colsWidthDict.get('create_time') || 170,
                hide: colsHideDict.get('create_time')
            // },
            // {
            //     field: 'ops',
            //     fixed: "right",
            //     title: "操作",
            //     width: colsWidthDict.get('ops') || 180,
            //     align: "center",
            //     toolbar: "#user-tools"
            }
        ]],
        // toolbar: '#user-table-tool',
        defaultToolbar: ['filter', 'exports', 'print'],
        title: '队列列表',
    });
    table.on('colToggled(data_table)', function (obj) {
        saveTableCols(obj, tableFlag);
    });
    table.on('colResized(data_table)', function (obj) {
        saveTableColWidth(obj, tableFlag);
    });
    // 表头工具栏
    table.on('toolbar(data_table)', function (obj) {
        switch (obj.event) {
        }
    });
    table.on('tool(data_table)', function (obj) {
        switch (obj.event) {
        }
    });
    $(function () {
        $('#searchBtn').click(function () {
            table.reloadData(instance.config.id, {
                url: '/system/jobList/',
                where: objectifyForm($('#searchForm').serializeArray()),
                page: {
                    curr: 1 //重新从第 1 页开始
                }
            })
        });
        $('#resetBtn').click(function () {
            window.location.href = "/system/jobs"
        });
    })
</script>
{/block}